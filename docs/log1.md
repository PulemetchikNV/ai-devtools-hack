Container main-agent    Recreated                                                                                                                                                                                    0.7s 
Attaching to main-agent, telegram-bot
main-agent    | get_mcp_tools_async MCP_URLS: https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp
main-agent    | MCP URLS https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp
main-agent    | 2025-12-09 21:26:23,850 INFO agent Connecting to MCP server: https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp
main-agent    | GOD SID FROM MCP SERVER: c564ea4c008d4487b88e56b382c87666
main-agent    | 2025-12-09 21:26:24,835 INFO httpx HTTP Request: POST https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp "HTTP/1.1 406 Not Acceptable"
main-agent    | 2025-12-09 21:26:24,837 INFO agent SSE not available, falling back to JSON: Expected response header Content-Type to contain 'text/event-stream', got 'application/json'
main-agent    | 2025-12-09 21:26:25,633 INFO httpx HTTP Request: POST https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp "HTTP/1.1 200 OK"
main-agent    | GOD SID FROM MCP SERVER: c564ea4c008d4487b88e56b382c87666
main-agent    | 2025-12-09 21:26:26,651 INFO httpx HTTP Request: POST https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp "HTTP/1.1 406 Not Acceptable"
main-agent    | 2025-12-09 21:26:26,652 INFO agent SSE not available, falling back to JSON: Expected response header Content-Type to contain 'text/event-stream', got 'application/json'
main-agent    | 2025-12-09 21:26:27,931 INFO httpx HTTP Request: POST https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp "HTTP/1.1 200 OK"
main-agent    | 2025-12-09 21:26:28,356 INFO agent Found 20 tools from https://880dfa33-1372-4b77-9cc8-9707bb5e5fd2-mcp-server.ai-agent.inference.cloud.ru/mcp
main-agent    | 2025-12-09 21:26:28,364 INFO agent   - Added tool: create_document
main-agent    | ADDED TOOL: name='create_document' description='Создает новый пустой .docx документ.\n\nСоздает новый документ Word по указанному пути. Путь может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nЕсли указан заголовок, он будет добавлен в документ как заголовок первого уровня.\n\nПримеры использования:\n- create_document(file_path="file:///path/to/document.docx", title="Мой документ")\n- create_document(file_path="/absolute/path/document.docx")\n- create_document(file_path="document.docx", title="Отчет")' args_schema=<class 'agent.create_documentArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf1684a0>
main-agent    | 2025-12-09 21:26:28,365 INFO agent   - Added tool: create_document_with_content
main-agent    | ADDED TOOL: name='create_document_with_content' description='Создает новый .docx документ с начальным содержимым.\n\nСоздает документ и заполняет его содержимым из словаря. Поддерживает:\n- Заголовки (headings)\n- Параграфы (paragraphs)\n- Таблицы (tables)\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- create_document_with_content(file_path="file:///path/to/doc.docx", content={"headings": [{"text": "Заголовок", "level": 1}], "paragraphs": ["Первый параграф", "Второй параграф"]})\n- create_document_with_content(file_path="doc.docx", content={"paragraphs": ["Текст"], "tables": [{"data": [["A", "B"], ["1", "2"]], "headers": ["Колонка 1", "Колонка 2"]}]})' args_schema=<class 'agent.create_document_with_contentArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2123e0>
main-agent    | 2025-12-09 21:26:28,366 INFO agent   - Added tool: read_document
main-agent    | ADDED TOOL: name='read_document' description='Читает полное содержимое .docx документа в структурированном виде.\n\nВозвращает структурированную информацию о документе:\n- Все параграфы с их текстом\n- Все таблицы с данными\n- Метаинформацию (статистику)\n\nФайл может быть передан:\n- Через путь: file:// URI, абсолютный или относительный путь\n- Через содержимое: base64 строка содержимого файла\n\nПримеры использования:\n- read_document(file_path="file:///path/to/document.docx")\n- read_document(file_content_base64="UEsDBBQAAAAI...")' args_schema=<class 'agent.read_documentArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212700>
main-agent    | 2025-12-09 21:26:28,367 INFO agent   - Added tool: extract_text
main-agent    | ADDED TOOL: name='extract_text' description='Извлекает весь текст из .docx документа в виде плоского текста.\n\nИзвлекает только текстовое содержимое без структуры. Подходит для быстрого получения текста.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- extract_text(file_path="file:///path/to/document.docx")\n- extract_text(file_path="document.docx")' args_schema=<class 'agent.extract_textArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf211bc0>
main-agent    | 2025-12-09 21:26:28,370 INFO agent   - Added tool: extract_paragraphs
main-agent    | ADDED TOOL: name='extract_paragraphs' description='Извлекает все параграфы из документа с метаданными.\n\nВозвращает список параграфов с информацией о стилях и индексах.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- extract_paragraphs(file_path="file:///path/to/document.docx")\n- extract_paragraphs(file_path="document.docx")' args_schema=<class 'agent.extract_paragraphsArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf211c60>
main-agent    | 2025-12-09 21:26:28,371 INFO agent   - Added tool: extract_tables
main-agent    | ADDED TOOL: name='extract_tables' description='Извлекает все таблицы из документа в структурированном виде.\n\nВозвращает все таблицы с их данными в формате JSON.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- extract_tables(file_path="file:///path/to/document.docx")\n- extract_tables(file_path="document.docx")' args_schema=<class 'agent.extract_tablesArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf16af20>
main-agent    | 2025-12-09 21:26:28,371 INFO agent   - Added tool: extract_table_by_index
main-agent    | ADDED TOOL: name='extract_table_by_index' description='Извлекает конкретную таблицу по индексу из документа.\n\nВозвращает данные таблицы в структурированном виде.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- extract_table_by_index(file_path="file:///path/to/document.docx", table_index=0)\n- extract_table_by_index(file_path="document.docx", table_index=1)' args_schema=<class 'agent.extract_table_by_indexArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2120c0>
main-agent    | 2025-12-09 21:26:28,372 INFO agent   - Added tool: get_document_info
main-agent    | ADDED TOOL: name='get_document_info' description='Получает метаинформацию о документе.\n\nВозвращает статистику: количество параграфов, таблиц, изображений, символов, слов и т.д.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- get_document_info(file_path="file:///path/to/document.docx")\n- get_document_info(file_path="document.docx")' args_schema=<class 'agent.get_document_infoArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212340>
main-agent    | ADDED TOOL: name='add_paragraph' description='Добавляет параграф в документ.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- add_paragraph(file_path="file:///path/to/document.docx", text="Новый параграф")\n- add_paragraph(file_path="document.docx", text="Текст", style="Normal")' args_schema=<class 'agent.add_paragraphArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212520>
main-agent    | 2025-12-09 21:26:28,374 INFO agent   - Added tool: add_paragraph
main-agent    | 2025-12-09 21:26:28,376 INFO agent   - Added tool: add_heading
main-agent    | ADDED TOOL: name='add_heading' description='Добавляет заголовок в документ.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- add_heading(file_path="file:///path/to/document.docx", text="Заголовок", level=1)\n- add_heading(file_path="document.docx", text="Подзаголовок", level=2)' args_schema=<class 'agent.add_headingArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf211b20>
main-agent    | 2025-12-09 21:26:28,377 INFO agent   - Added tool: add_table
main-agent    | ADDED TOOL: name='add_table' description='Добавляет таблицу в документ из данных.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- add_table(file_path="file:///path/to/document.docx", data=[["A", "B"], ["1", "2"]], headers=["Колонка 1", "Колонка 2"])\n- add_table(file_path="document.docx", data=[["Значение 1", "Значение 2"]])' args_schema=<class 'agent.add_tableArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212200>
main-agent    | 2025-12-09 21:26:28,378 INFO agent   - Added tool: add_table_from_dicts
main-agent    | ADDED TOOL: name='add_table_from_dicts' description='Добавляет таблицу в документ из списка словарей.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- add_table_from_dicts(file_path="file:///path/to/document.docx", rows=[{"name": "Иван", "age": 30}, {"name": "Мария", "age": 25}])' args_schema=<class 'agent.add_table_from_dictsArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf211940>
main-agent    | ADDED TOOL: name='replace_text' description='Заменяет текст в документе.\n\nИщет и заменяет все вхождения указанного текста в документе.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- replace_text(file_path="file:///path/to/document.docx", old_text="Старый текст", new_text="Новый текст")' args_schema=<class 'agent.replace_textArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2119e0>
main-agent    | 2025-12-09 21:26:28,379 INFO agent   - Added tool: replace_text
main-agent    | ADDED TOOL: name='add_page_break' description='Добавляет разрыв страницы в документ.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- add_page_break(file_path="file:///path/to/document.docx")' args_schema=<class 'agent.add_page_breakArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2122a0>
main-agent    | 2025-12-09 21:26:28,379 INFO agent   - Added tool: add_page_break
main-agent    | 2025-12-09 21:26:28,380 INFO agent   - Added tool: render_template
main-agent    | ADDED TOOL: name='render_template' description='Заполняет шаблон .docx данными используя Jinja2 (docxtpl).\n\nПоддерживает Jinja2 синтаксис для подстановки переменных в шаблоне:\n- {{ variable }} - простая переменная\n- {% for item in items %}...{% endfor %} - циклы\n- {% if condition %}...{% endif %} - условия\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- render_template(template_path="file:///path/to/template.docx", output_path="file:///path/to/output.docx", context={"name": "Иван", "date": "2024-01-01"})\n- render_template(template_path="template.docx", output_path="output.docx", context={"company": "ООО Рога и Копыта", "items": [{"name": "Товар 1", "price": 100}]})' args_schema=<class 'agent.render_templateArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf211d00>
main-agent    | ADDED TOOL: name='render_template_from_json' description='Заполняет шаблон .docx данными из JSON строки.\n\nУдобно для передачи данных из внешних источников в формате JSON.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- render_template_from_json(template_path="file:///path/to/template.docx", output_path="output.docx", json_data=\'{"name": "Иван", "date": "2024-01-01"}\')' args_schema=<class 'agent.render_template_from_jsonArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212160>
main-agent    | 2025-12-09 21:26:28,381 INFO agent   - Added tool: render_template_from_json
main-agent    | 2025-12-09 21:26:28,381 INFO agent   - Added tool: get_template_variables
main-agent    | ADDED TOOL: name='get_template_variables' description='Извлекает переменные из шаблона .docx.\n\nАнализирует шаблон и находит все переменные Jinja2 ({{ variable }}).\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- get_template_variables(template_path="file:///path/to/template.docx")\n- get_template_variables(template_path="template.docx")' args_schema=<class 'agent.get_template_variablesArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212480>
main-agent    | ADDED TOOL: name='validate_template' description='Валидирует шаблон перед рендерингом.\n\nПроверяет, что все переменные в шаблоне присутствуют в контексте.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- validate_template(template_path="file:///path/to/template.docx", context={"name": "Иван", "date": "2024-01-01"})' args_schema=<class 'agent.validate_templateArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf212660>
main-agent    | 2025-12-09 21:26:28,382 INFO agent   - Added tool: validate_template
main-agent    | 2025-12-09 21:26:28,383 INFO agent   - Added tool: merge_documents
main-agent    | ADDED TOOL: name='merge_documents' description='Объединяет несколько .docx документов в один.\n\nОбъединяет содержимое всех документов в указанном порядке в один новый документ.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- merge_documents(output_path="file:///path/to/merged.docx", file_paths=["file:///path/to/doc1.docx", "file:///path/to/doc2.docx"])\n- merge_documents(output_path="merged.docx", file_paths=["doc1.docx", "doc2.docx", "doc3.docx"])' args_schema=<class 'agent.merge_documentsArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2125c0>
main-agent    | 2025-12-09 21:26:28,384 INFO agent   - Added tool: append_document
main-agent    | ADDED TOOL: name='append_document' description='Добавляет содержимое одного документа к другому.\n\nДобавляет содержимое source_path к концу target_path.\n\nПуть может быть:\n- file:// URI (MCP resource)\n- Абсолютный путь\n- Относительный путь\n\nПримеры использования:\n- append_document(target_path="file:///path/to/target.docx", source_path="file:///path/to/source.docx")\n- append_document(target_path="main.docx", source_path="appendix.docx")' args_schema=<class 'agent.append_documentArgs'> func=<function create_langchain_tool_from_mcp.<locals>.tool_func at 0xffffaf2127a0>
main-agent    | 2025-12-09 21:26:28,461 INFO __main__ Starting LangChain Agent server on port 10000
main-agent    | INFO:     Started server process [10]
main-agent    | INFO:     Waiting for application startup.
main-agent    | INFO:     Application startup complete.
main-agent    | INFO:     Uvicorn running on http://0.0.0.0:10000 (Press CTRL+C to quit)
telegram-bot  | Installed 14 packages in 82ms
telegram-bot  | 2025-12-09 21:26:37,944 - __main__ - INFO - Bot is starting...
telegram-bot  | 2025-12-09 21:26:38,855 - __main__ - WARNING - Could not send startup message to admin: Telegram server says - Bad Request: chat not found
telegram-bot  | 2025-12-09 21:26:38,855 - __main__ - INFO - Starting polling...
telegram-bot  | 2025-12-09 21:26:38,856 - aiogram.dispatcher - INFO - Start polling
telegram-bot  | 2025-12-09 21:26:38,970 - aiogram.dispatcher - INFO - Run polling for bot @test123mcp123bot id=8353110046 - 'test-mcp'
Gracefully stopping... (press Ctrl+C again to force)